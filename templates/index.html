{% extends "base.html" %}
{% block content %}
<main class="container main">
  <section class="upload-card">
    <p class="muted">Bem-vindo ao <strong>INFLUE</strong></p>
    <h2 class="card-title">Faça upload e receba orientação inteligente</h2>

    <div class="actions">
      <form id="form-photo" class="upload" action="/analyze_photo" method="post" enctype="multipart/form-data">
        <input id="photo-input" type="file" name="photo" accept="image/*" hidden />
        <button type="button" class="btn btn-outline" id="btn-photo" aria-controls="photo-input">
          Enviar foto (JPG/PNG)
        </button>

        <div class="field" style="margin-top:.75rem;">
          <label for="intent" class="label">
            O que você quer que o INFLUE responda? <span class="muted">(até 140 caracteres)</span>
          </label>
          <input
            id="intent"
            name="intent"
            type="text"
            maxlength="140"
            placeholder="Ex.: Essa foto é adequada para o LinkedIn?"
            aria-describedby="intent-help intent-counter"
            autocomplete="off"
          />
          <div class="flex between center-v" style="margin-top:.25rem;">
            <small id="intent-help" class="muted">Opcional. Uma frase curta orienta a análise da IA.</small>
            <small id="intent-counter" class="muted">0/140</small>
          </div>
        </div>
      </form>

      <form id="form-text" class="upload" action="/analyze_text" method="post" enctype="application/json">
        <button type="button" class="btn btn-outline" id="btn-text">
          Enviar texto/legenda
        </button>
      </form>
    </div>

    <div class="text-area">
      <label for="textcontent" class="label">Cole sua legenda/texto:</label>
      <textarea id="textcontent" rows="4" placeholder="Digite ou cole aqui..."></textarea>
      <div class="right">
        <button type="button" class="btn btn-primary" id="btn-submit-text">Analisar texto</button>
      </div>
    </div>

    <!-- ALTERADO: ID exclusivo para feedback da página -->
    <div id="page-feedback" class="feedback" role="status" aria-live="polite"></div>

    <div id="analysis-output" class="analysis" style="display:none;">
      <h3>Resultado da análise</h3>
      <p id="analysis-summary" class="muted"></p>
      <div class="chips">
        <div class="chip"><strong>Score de risco:</strong> <span id="analysis-score">—</span>/100</div>
        <div class="chip"><strong>Tags:</strong> <span id="analysis-tags">—</span></div>
      </div>
      <div class="recs">
        <strong>Recomendações:</strong>
        <ol id="analysis-recs"></ol>
      </div>
    </div>
  </section>

  <section class="hero-copy">
    <h1 class="title">Analise antes de postar.</h1>
    <p class="subtitle">Proteja sua imagem. Maximize seu alcance. IA que orienta você em segundos.</p>
    <ul class="bullets">
      <li>Créditos do usuário para uso justo.</li>
      <li>Envie uma <strong>foto</strong> ou uma <strong>legenda/texto</strong>.</li>
      <li>Resultado imediato com <em>score</em>, <em>tags</em> e <em>recomendações</em>.</li>
    </ul>
  </section>
</main>

<script>
  (function () {
    const intent = document.getElementById('intent');
    const counter = document.getElementById('intent-counter');
    if (intent && counter) {
      const update = () => { counter.textContent = (intent.value || '').length + '/140'; };
      intent.addEventListener('input', update);
      update();
    }
  })();
</script>
{% endblock %}
