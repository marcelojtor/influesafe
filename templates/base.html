<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>INFLUE — Assistente de Imagem & Engajamento</title>
  <meta name="description" content="Analise sua foto ou texto antes de postar. Proteja sua imagem e alavanque seu engajamento." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
</head>
<body class="theme-dark">
  <header class="topbar">
    <div class="container topbar-row">
      <a class="brand" href="/" aria-label="Ir para início">
        <div class="logo">I</div>
        <span class="brandtext">INFLUE</span>
      </a>

      <nav class="auth">
        <span id="user-state" class="pill tag" title="Estado de sessão">
          <svg width="10" height="10" viewBox="0 0 10 10" aria-hidden="true"><circle cx="5" cy="5" r="5" fill="#60a5fa"/></svg>
          <span id="user-label">Convidado</span>
        </span>

        <span class="credits muted">
          Créditos:
          <strong id="credits-left" data-credits="{{ credits_left|default(0) }}">
            Sessão: {{ credits_left|default(0) }} | Usuário: —
          </strong>
        </span>

        <!-- mantém o botão antigo, mas oculto (compat JS) -->
        <button id="btn-purchase" class="btn btn-primary" type="button" style="display:none;">Comprar 10 créditos</button>
        <!-- link novo visível -->
        <a id="btn-buy-link" class="btn btn-primary" href="/buy">Comprar 10 créditos</a>

        <button id="btn-open-auth" class="btn btn-ghost" type="button">Entrar / Criar conta</button>
        <button id="btn-logout" class="btn btn-ghost" type="button" style="display:none;">Sair</button>
      </nav>
    </div>
  </header>

  {% block content %}{% endblock %}

  <footer class="footer">
    <div class="container footer-row">
      <small>© <span id="year"></span> INFLUE. Todos os direitos reservados.</small>
      <small class="muted">Política de Privacidade • <a class="link" href="/privacy">/privacy</a></small>
    </div>
  </footer>

  <!-- Backdrop do modal -->
  <div id="auth-backdrop" class="modal-backdrop" aria-hidden="true"></div>

  <!-- Modal de Autenticação -->
  <section id="auth-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="auth-title" aria-hidden="true">
    <div class="panel">
      <div class="panel-head">
        <h2 id="auth-title">Acessar INFLUE</h2>
        <button id="auth-close" class="btn btn-ghost" type="button" aria-label="Fechar">Fechar</button>
      </div>

      <div class="tabs" role="tablist" aria-label="Opções de autenticação">
        <div id="tab-login"  class="tab active" role="tab" aria-selected="true"  tabindex="0">Entrar</div>
        <div id="tab-signup" class="tab"        role="tab" aria-selected="false" tabindex="-1">Criar conta</div>
      </div>

      <!-- ENTRAR -->
      <form id="form-login" class="form">
        <label class="field">
          <span class="label">E-mail</span>
          <input id="auth-email" type="email" placeholder="voce@exemplo.com" autocomplete="email" required />
        </label>
        <label class="field">
          <span class="label">Senha</span>
          <input id="auth-password" type="password" placeholder="••••••••" autocomplete="current-password" required />
        </label>
        <div class="form-actions">
          <button id="btn-login" class="btn btn-primary" type="submit">Entrar</button>
        </div>
        <p class="hint">Ainda não é cadastrado? <span id="link-open-signup" class="muted-link">Crie sua conta agora</span>.</p>
      </form>

      <!-- CRIAR CONTA -->
      <form id="form-signup" class="form" style="display:none;">
        <label class="field">
          <span class="label">E-mail</span>
          <input id="reg-email" type="email" placeholder="voce@exemplo.com" autocomplete="email" required />
        </label>
        <label class="field">
          <span class="label">Confirmar e-mail</span>
          <input id="reg-email2" type="email" placeholder="voce@exemplo.com" autocomplete="email" required />
        </label>
        <label class="field">
          <span class="label">Senha</span>
          <input id="reg-pass" type="password" placeholder="Mínimo 6 caracteres" autocomplete="new-password" required />
        </label>
        <label class="field">
          <span class="label">Confirmar senha</span>
          <input id="reg-pass2" type="password" placeholder="Repita a senha" autocomplete="new-password" required />
        </label>
        <div class="form-actions">
          <button id="btn-register" class="btn btn-primary" type="submit">Criar conta</button>
        </div>
        <p class="hint">Já possui cadastro? <span id="link-open-login" class="muted-link">Entrar</span>.</p>
      </form>

      <div id="feedback" class="feedback" role="status" aria-live="polite"></div>
      <div class="divider"></div>
      <small class="muted">Ao continuar, você concorda com nossos termos e a política de privacidade.</small>
    </div>
  </section>

  <script>
    // Modal + tabs (exatamente como antes; apenas organizado)
    (function(){
      const modal = document.getElementById('auth-modal');
      const backdrop = document.getElementById('auth-backdrop');
      const openBtn = document.getElementById('btn-open-auth');
      const closeBtn = document.getElementById('auth-close');
      const tabLogin  = document.getElementById('tab-login');
      const tabSignup = document.getElementById('tab-signup');
      const formLogin  = document.getElementById('form-login');
      const formSignup = document.getElementById('form-signup');
      const linkOpenSignup = document.getElementById('link-open-signup');
      const linkOpenLogin  = document.getElementById('link-open-login');

      function showModal(){
        modal.classList.add('show'); backdrop.classList.add('show');
        modal.setAttribute('aria-hidden','false'); backdrop.setAttribute('aria-hidden','false');
        setTimeout(()=>document.getElementById('auth-email')?.focus(), 40);
      }
      function hideModal(){
        modal.classList.remove('show'); backdrop.classList.remove('show');
        modal.setAttribute('aria-hidden','true'); backdrop.setAttribute('aria-hidden','true');
      }
      function setTab(mode){
        const isLogin = mode === 'login';
        tabLogin.classList.toggle('active', isLogin);
        tabSignup.classList.toggle('active', !isLogin);
        formLogin.style.display  = isLogin ? '' : 'none';
        formSignup.style.display = isLogin ? 'none' : '';
        (isLogin ? document.getElementById('auth-email') : document.getElementById('reg-email'))?.focus();
      }

      openBtn?.addEventListener('click', showModal);
      closeBtn?.addEventListener('click', hideModal);
      backdrop?.addEventListener('click', hideModal);
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') hideModal(); });
      tabLogin?.addEventListener('click', ()=>setTab('login'));
      tabSignup?.addEventListener('click', ()=>setTab('signup'));
      linkOpenSignup?.addEventListener('click', ()=>setTab('signup'));
      linkOpenLogin?.addEventListener('click', ()=>setTab('login'));

      window.__influe_show_auth__ = showModal;
      window.__influe_hide_auth__ = hideModal;
      window.__influe_set_auth_tab__ = setTab;
    })();
  </script>

  <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
</body>
</html>
